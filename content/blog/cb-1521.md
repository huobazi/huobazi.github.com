---
layout: post
title: 用Asp.Net抓取web页面
comments: true
date: 2004-02-23
tags:
- ASP.NET
- Asp.net
- 代码片段
---

<p><span style="color: #990000;">演示:<br /><a href="http://www.github.com/demo/286.aspx" target="_blank">http://www.github.com/demo/286.aspx</a></span></p>
<p><span style="color: #990000;"><br />代码高亮显示(HightLight in <a href="http://www.github.com/scv/">Source Code Viewer</a>)</span></p>
<p><span style="color: #990000;"><br /><a href="http://www.github.com/code/default.aspx/S7s2zPJbeI9PJA/OKHpAVwVaUEhf02EgEOgeB3Yd5Z7fLL3ZNgdv7XIqertUOYm9kbQ62LshbJBwvWPBBYa4EyVMhvMhyEDPH8chU5ornn8=.Aspx" target="_blank">http://www.github.com/code/default.aspx/S7s2zPJbeI9PJA/OK<br />HpAVwVaUEhf02EgEOgeB3Yd5Z7fLL3ZNgdv7XIqertUOYm9kbQ62<br />LshbJBwvWPBBYa4EyVMhvMhyEDPH8chU5ornn8=.Aspx</a></span><br /><span style="color: #990000;">&lt;html&gt;<br />&lt;head&gt;<br /> </span><br /><span style="color: #990000;">&lt;SCRIPT runat="server"&gt;<br />  void Page_Load(Object sender, EventArgs e) {</span><br /><span style="color: #990000;">    WebRequest req = WebRequest.Create("<a href="http://www.im286.com/index.php" target="_blank">http://www.im286.com/index.php</a>");<br /> string urliii="src="; //图片使用绝对连接<br /> urliii+="<a href="http://www.im286.com/" target="_blank">http://www.im286.com/</a>";<br />    try {<br />        WebResponse result = req.GetResponse();<br />        Stream ReceiveStream = result.GetResponseStream();</span><br /><span style="color: #990000;">        Byte[] read = new Byte[512];<br />        int bytes = ReceiveStream.Read(read, 0, 512);</span><br /><span style="color: #990000;">        lblHTML.Text = "";<br />        while (bytes &gt; 0)<br />        {</span><br /><span style="color: #990000;">          // 注意：<br />          // 下面假定响应使用 gb2312 作为编码方式。<br />          // 如果内容以 ANSI 代码页形式（例如，932）发送，则使用类似下面的语句：<br />          //Encoding encode = System.Text.Encoding.GetEncoding("shift-jis");<br />          Encoding encode = System.Text.Encoding.GetEncoding("gb2312");<br />          lblHTML.Text = lblHTML.Text + encode.GetString(read, 0, bytes);<br />   <br />          bytes = ReceiveStream.Read(read, 0, 512);<br />   <br />        }<br />    } catch(Exception) {<br />        lblHTML.Text = "检索页时出错";<br />    }<br /> lblHTML.Text = lblHTML.Text.Replace("src=",""+urliii+"");<br /> lblHTML.Text = lblHTML.Text.Replace("\"","");<br />  }<br />&lt;/SCRIPT&gt;<br />&lt;/head&gt;</span><br /><span style="color: #990000;">&lt;body&gt;</span><br /><span style="color: #990000;">  &lt;form method="post" action="Webrequest.aspx" runat="server"&gt;<br />   <br />    &lt;asp:Label runat=server ID="lblHTML" Rows="30" Cols="80" EnableViewState="false"  Wrap="True"&gt;&lt;/asp:Label&gt;<br />  &lt;/form&gt;</span><br /><span style="color: #990000;">&lt;/body&gt;<br />&lt;/html&gt;</span></p>
<p>&lt;%@ Page language="C#" Trace="True" %&gt;<br />&lt;%@ Import Namespace="System.Net" %&gt;<br />&lt;%@ Import Namespace="System.IO" %&gt;</p>				
