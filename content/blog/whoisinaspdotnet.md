---
layout: post
title: 域名Whois信息查询(ASP.NET+C#)
comments: true
date: 2004-02-04
categories:
- ASP.NET
- Asp.net
- .Net其他
- 代码片段
---

<p>去年写的了,是从<a href="http://http://blog.joycode.com/aspdian/posts/4466.aspx">点缀</a>的博客学来的<br />看演示请点这里:<a href="http://www.aspxboy.com/whois.aspx">http://www.aspxboy.com/whois.aspx</a><br />代码如下:<br /><span style="color: #a52a2a;">&lt;% @Page Language="C#" %&gt;<br />&lt;% @Import Namespace="System.Net.Sockets" %&gt;<br />&lt;% @Import Namespace="System.Text" %&gt;<br />&lt;% @Import Namespace="System.IO" %&gt;<br />&lt;html&gt;<br />&lt;head&gt;<br />&lt;title&gt;.Com/.Net/.Org/.Cn 域名Whois信息查询&lt;/title&gt;<br />&lt;meta name="keywords" content=".Com,.Net,.Org,.Cn 域名Whois信息查询"&gt;<br />&lt;meta name="generator" content=".Com/.Net/.Org,.Cn 域名Whois信息查询"&gt;<br />&lt;meta name="description" content=".Com/.Net/.Org,.Cn 域名Whois信息查询"&gt;<br />&lt;style&gt;<br />&lt;!--<br />body,input{<br />        font-family: Tahoma, Verdana; color: #004080; font-size: 12px        <br />        }<br />a:link,a:visited{<br />        text-decoration: none; color: #004080<br />        }<br />--&gt;<br />&lt;/style&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&lt;form id="fmQuery" runat="server"&gt;<br />&amp;nbsp;要查询的域名域名:<br />www.&lt;asp:TextBox id="txtDomain" width="100" value="ASPXBOY.COM" runat="server" /&gt;<br />&amp;nbsp; &lt;asp:Button id="btnQuery" OnClick="btn_click"<br />text="查询!" runat="server" /&gt;（只能查询.Com/.Net/.Org/.Cn 域名Whois的信息）&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a href ="WhoisCode.htm" title="View the source code here!"&gt;源代码在这里&lt;/a&gt;<br />&lt;BR&gt;&lt;HR width="550" height="1" align="left"&gt;&lt;BR&gt;<br />&lt;asp:label id="lblResult" runat="server" /&gt;<br />&lt;/form&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br />&lt;script language="C#" runat="server"&gt;<br />void btn_click(Object sender, EventArgs e)<br />{<br />String strServer;<br />String strDomain = txtDomain.Text;<br />String strServerCom = "whois.networksolutions.com";<br />String strServerCN = "whois.cnnic.net.cn";<br />String strResponse;<br />string[] arrDomain = strDomain.Split('.');<br />if (arrDomain[1].ToUpper()=="CN")<br />{<br />       <br />        strServer=strServerCN;<br />}<br />else<br />{<br />        strServer=strServerCom;<br />}</span></p>
<p>bool blSuccess = IsWhosisSuccess(strDomain, strServer, out strResponse);<br />if (blSuccess)<br />{<br />lblResult.Text = strResponse;<br />}<br />else<br />{<br />lblResult.Text = "查找失败....";<br />}<br />}<br />bool IsWhosisSuccess(String strDomain, String strServer,<br />                   out String strResponse)<br />{<br />  strResponse = "none";<br />  bool blSuccess = false;<br />  TcpClient tcpc = new TcpClient();<br />  try<br />  {<br />    tcpc.Connect(strServer, 43);<br />  }<br />  catch(SocketException ex)<br />  {<br />    strResponse = "连接不到该 Whois server,请稍后再试。";<br />    return false;<br />  }</p>
<p>  strDomain += "\r\n";<br />  Byte[] arrDomain = Encoding.UTF8.GetBytes(strDomain.ToCharArray());<br />  try<br />  {<br />        Stream s = tcpc.GetStream();<br />        s.Write(arrDomain, 0, strDomain.Length);<br />       <br />        StreamReader sr = new StreamReader(tcpc.GetStream(), Encoding.UTF8);<br />        StringBuilder strBuilder = new StringBuilder();<br />        string strLine = null;</p>
<p>        while (null != (strLine = sr.ReadLine()))<br />        {<br />                strBuilder.Append(strLine+"&lt;br&gt;");<br />        }<br />        tcpc.Close();<br />               <br />        blSuccess = true;<br />        string my="Go to Huobazi's WebSite：&lt;a href=\"http://www.aspxboy.com\" title=\".Net男孩社区\"&gt;www.AspxBoy.Com&lt;/a&gt;&lt;br&gt;";<br />        strResponse = strBuilder.ToString()+my;  }<br />  catch(Exception e)<br />  {<br />        strResponse = e.ToString();<br />  }<br />  <br />  return blSuccess;<br />}<br />  &lt;/script&gt;</p>				
